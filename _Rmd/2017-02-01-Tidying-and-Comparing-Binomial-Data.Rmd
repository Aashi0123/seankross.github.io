---
layout: post
title: "Tidying and Comparing Binomial Data"
date: 2017-02-07 23:00:00
jumbo_title: Tidying and Comparing Binomial Data
jumbo_subtitle:
---

Lately I've been pressuring to myself to create very fancy blog posts, and 
although I enjoy writing in-depth posts I find that it can be limiting in terms
of what I allow myself to write. My general ethos is than one should just make 
something, even if it's just a small tip, and put it on the
web. Two folks who are fantastic at doing this are
[Lucy McGowan](https://twitter.com/LucyStats) and 
[Nick Strayer](https://twitter.com/NicholasStrayer)
who publish the [Live Free or Dichotomize](http://livefreeordichotomize.com/) 
blog together. I intended for my blog to be more of a public technical diary 
than a highly produced personal branding vehicle, so here it goes.

Recently I was asked to compare two datasets which contained binomial data
across the same variables. My colleague asked me to compare the proportion of
`TRUE` measurements between groups for each variable. After coming up with this
workflow I thought it might be something I could use again and it might be
useful to others too. The datasets I was dealing with were significantly larger
than the datasets in this post though they have the same structure.

I'm also consistently delighted to use `tidyr`, especially if I can use one of
the package's functions without looking at the help pages (Though they're well
written and you should certainly look at them often!) This is pretty simple
example of basic data tidying and modeling, but I'd like flesh out this process
by showing the resulting data frame after each step in this pipeline. First
let's set up the fake data which resembles the real data that lead me to this
procedure:

```{r, message=FALSE}
library(dplyr)
library(tidyr)
library(purrr)

set.seed(2017-01-31)

# Setting up fake data
datasetA <- sample(c(TRUE, FALSE), 1000, replace = TRUE) %>%
  matrix(ncol = 10) %>%
  as_data_frame()
colnames(datasetA) <- paste0("variable", 0:9)

datasetB <- sample(c(TRUE, FALSE), 1000, replace = TRUE, prob = c(.4, .6)) %>%
  matrix(ncol = 10) %>%
  as_data_frame()
colnames(datasetB) <- paste0("variable", 0:9)

datasetA
```

As you can see

```{r}
datasetA %>%
  map_df(sum)
```

```{r}
datasetA %>%
  map_df(sum) %>%
  gather(variable, n_true)
```

```{r}
tbl_a <- datasetA %>%
  map_df(sum) %>%
  gather(variable, n_true) %>%
  mutate(set = "A")

tbl_a
```

```{r}
tbl_b <- datasetB %>%
  map_df(sum) %>%
  gather(variable, n_true) %>%
  mutate(set = "B")
```

```{r}
bind_rows(tbl_a, tbl_b) %>%
  spread(set, n_true)
```

```{r}
bind_rows(tbl_a, tbl_b) %>%
  spread(set, n_true) %>%
  mutate(models = map2(A, B, ~ prop.test(c(.x, .y), c(100, 100))))
```

```{r}
prop_tbl <- bind_rows(tbl_a, tbl_b) %>%
  spread(set, n_true) %>%
  mutate(models = map2(A, B, ~ prop.test(c(.x, .y), c(100, 100)))) %>%
  mutate(p_value = map_dbl(.$models, ~ .$p.value)) %>%
  mutate(p_value = p.adjust(p_value, method = "bonferroni")) %>%
  mutate(signif = p_value < .05)

prop_tbl
```